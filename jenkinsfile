
pipeline {
    agent any
    options {
        timeout(time: 60, unit: 'MINUTES')
        timestamps()
        buildDiscarder(logRotator(numToKeepStr: '5'))
        }
    stages {
        stage('list_files') {
            steps {
                script {
                    try {
                        echo " List of files"
                        sh 'ls -ltr'
                        def str = '''\
                        <Server port="8005" shutdown="SHUTDOWN">
                        <Service name="Catalina">
                            <Connector port="8080" URIEncoding="UTF-8" protocol="HTTP/1.1" connectionTimeout="20000" redirectPort="8443"/>
                            <Connector port="8443" protocol="HTTP/1.1" SSLEnabled="true"
                                maxThreads="150" scheme="https" secure="true"
                                keystoreFile="/something/q2_reports/server_QA1/keystorea.jks" keystorePass="password"
                                clientAuth="false" sslProtocol="TLS" />
                            <Connector port="8009" protocol="AJP/1.3" redirectPort="8443"/>
                        </Service>
                        </Server>'''

                        def xml = new XmlParser().parseText(str)
                        xml.Service.Connector.indexed(1).each { i, connectorNode -> 
                        println "\nConnector $i"
                        connectorNode.attributes().each { k, v -> 
                            println "$k -> $v"
                        }
                        }
                        }
                    catch (exec) {
                        echo 'Something didnot work and got some exceptions'
                        }
                    }
                }
            }
        stage('parsexml') {
            steps {
                script {
                    try {
                        echo " +++++++= Parsing ++++++++"
                        def xml = '''
                        <AS Name="123">
                            <Config Name="Configuration1">
                                <Servers>
                                    <Server Name="server1"/>
                                    <Server Name="server2"/>
                                    <Server Name="server3"/>
                                    <Server Name="server4"/>
                                </Servers>
                            </Config>
                        </AS>
                        '''

                        def config = new XmlParser().parseText(xml)
                        config.Config.Servers.Server.each{
                            println it.@Name
                        }
                        }
                    catch (exec) {
                        echo 'Something didnot work and got some exceptions'
                        }
                    }
                }
            }
        }
    post {
        always {
            //junit 'build/reports/**/*.xml'
            echo 'No Error'
        }
        success {
            echo 'success Parsing'
        }
        failure {
            echo 'parsing failed'
            
        }
        unstable {
            echo 'current Pipeline has "unstable" state, usually by a failed test, code violations and other causes, in order to run. Usually represented in a web UI with a yellow indication.'
        }
        changed {
            echo 'can only be run if the current Pipeline is running at a different state than the previously completed Pipeline'
        }
    }
}